<div class="col-md-12 artist-lexicon">
  <h1><%= "#{object[:artist]}'s lexicon"%></h2>
</div>
<div class="col-md-3 indv-artist-bio artist-lexicon">
  <!-- <p><%=object[:words]%></p> -->
  <svg id="graph"></svg>
</div>


<%= javascript_tag do %>
var name = "<%= object[:artist] %>"
$.ajax({
         type: "GET",
         contentType: "application/json; charset=utf-8",
         url: 'data',
         data:{artist:name},
         dataType: 'json',
         success: function (data) {
           var words = data.words
           var words_data = []
           var words_list = []
             for(var key in words){
               words_data.push(words[key])
             }
             console.log(words_data.sort(function(a, b){return b-a}))
             draw(words_data.slice(0,10));
         },
         error: function (result) {
             error();
         }
     });

function draw(data) {
  var color = d3.scale.category20b();
  var width = data[0],
      barHeight = 60;

  var x = d3.scale.linear()
      .range([0, width])
      .domain([0, d3.max(data)]);

  var chart = d3.select("#graph")
      .attr("width", width)
      .attr("height", barHeight * data.length);

  var bar = chart.selectAll("g")
      .data(data)
      .enter().append("g")
      .attr("transform", function (d, i) {
                return "translate(0," + i * barHeight + ")";
            });

  bar.append("rect")
      .attr("width", x)
      .attr("height", barHeight - 1)
      .style("fill", function (d) {
                 return color(d)
             })

  bar.append("text")
      .attr("x", function (d) {
            console.log(d);
                return x(d) - d;
            })
      .attr("y", barHeight / 2)
      .attr("dy", ".35em")
      .style("fill", "white")
      .text(function (word) {
                return word[0];
            });
}

function error() {
  console.log("error")
}

<% end %>
